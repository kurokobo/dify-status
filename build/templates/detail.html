<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ check.name }} - {{ site_title }}</title>
  <link rel="stylesheet" href="../static/style.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4/dist/chart.umd.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
</head>
<body>
  <div class="container" x-data="detailApp()">
    <header>
      <a href="../index.html" class="back-link">&larr; Back to overview</a>
      <h1>{{ check.name }}</h1>
      <p class="check-description">{{ check.description }}</p>
      {% if check.note %}<p class="check-note">{{ check.note }}</p>{% endif %}
      <div class="overall-status" :class="'status-banner-' + checkSummary.current_status">
        <span x-text="checkSummary.current_status"></span>
      </div>
    </header>

    <main>
      <!-- 90-day grid -->
      <div class="check-row">
        <div class="check-header">
          <span class="check-name">{{ check.name }}</span>
        </div>
        <div class="grid-90">
          <template x-for="day in checkSummary.days" :key="day.date">
            <div class="grid-cell"
                 :class="'cell-' + day.status + (selectedDate === day.date ? ' cell-selected' : '')"
                 :title="day.date"
                 @click="selectDate(day.date)"
                 @mouseenter="showCheckTooltip($event, day, '{{ check.name }}')"
                 @mouseleave="hideTooltip()">
            </div>
          </template>
        </div>
      </div>

      <div class="legend">
        <span class="legend-item"><span class="legend-color cell-up"></span> Up</span>
        <span class="legend-item"><span class="legend-color cell-degraded"></span> Degraded</span>
        <span class="legend-item"><span class="legend-color cell-down"></span> Down</span>
        <span class="legend-item"><span class="legend-color cell-nodata"></span> No Data</span>
      </div>

      <!-- Daily detail -->
      <section class="daily-detail">
        <h2 x-text="selectedDate ? 'Results for ' + selectedDate : 'Click a day to view details'"></h2>
        <div x-show="loading" class="loading">Loading...</div>

        <!-- Hourly status grid -->
        <div x-show="!loading && dayRecords.length > 0">
          <h3 class="section-subheading">Hourly Status</h3>
          <div class="grid-24">
            <template x-for="h in hourlyStatus" :key="h.hour">
              <div class="grid-cell"
                   :class="'cell-' + h.status"
                   :title="h.hour + ':00 — ' + h.status + ' (' + h.count + ' checks)'"
                   @mouseenter="showHourTooltip($event, h)"
                   @mouseleave="hideTooltip()">
              </div>
            </template>
          </div>
          <div class="hour-labels">
            <span>0</span><span>6</span><span>12</span><span>18</span><span>23</span>
          </div>
        </div>

        <!-- Response time chart -->
        <div x-show="!loading && dayRecords.length > 0" class="chart-container">
          <h3 class="section-subheading">Response Time</h3>
          <canvas x-ref="responseChart"></canvas>
        </div>

        <div x-show="!loading && dayRecords.length > 0">
          <table class="results-table">
            <thead>
              <tr>
                <th>Time (UTC)</th>
                <th>Status</th>
                <th>Response Time</th>
                <th>Message</th>
              </tr>
            </thead>
            <tbody>
              <template x-for="r in dayRecords" :key="r.timestamp">
                <tr>
                  <td x-text="r.timestamp.substring(11, 19)"></td>
                  <td><span class="check-status-badge" :class="'badge-' + r.status" x-text="r.status"></span></td>
                  <td x-text="r.response_time_ms >= 0 ? r.response_time_ms + ' ms' : '-'"></td>
                  <td x-text="r.message"></td>
                </tr>
              </template>
            </tbody>
          </table>
        </div>
        <div x-show="!loading && selectedDate && dayRecords.length === 0" class="no-data">
          No data for this date.
        </div>
      </section>
    </main>

    <!-- Tooltip -->
    <div class="tooltip" x-show="tooltip.visible" x-transition
         :style="'left:' + tooltip.x + 'px; top:' + tooltip.y + 'px'">
      <div class="tooltip-date" x-text="tooltip.date"></div>
      <div x-show="tooltip.name" class="tooltip-name" x-text="tooltip.name"></div>
      <div class="tooltip-status" :class="'text-' + tooltip.status" x-text="tooltip.status"></div>
      <div x-show="tooltip.uptime !== null" class="tooltip-detail">
        Uptime: <span x-text="tooltip.uptime"></span>%
      </div>
      <div x-show="tooltip.avgResp >= 0" class="tooltip-detail">
        Avg response: <span x-text="tooltip.avgResp"></span> ms
      </div>
    </div>

    <footer>
      <p>This is an unofficial status page. Not affiliated with Dify.</p>
      <p>Built by <a href="https://github.com/kurokobo">@kurokobo</a> · <a href="https://github.com/kurokobo/dify-status">Source on GitHub</a></p>
    </footer>
  </div>

  <script>
    const SUMMARY_DATA = {{ summary_json | safe }};
    const CHECK_ID = "{{ check.id }}";
  </script>
  <script src="../static/app.js"></script>
</body>
</html>
