<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ site_title }}</title>
  <link rel="stylesheet" href="static/style.css">
  <script defer src="https://cdn.jsdelivr.net/npm/@alpinejs/collapse@3.x.x/dist/cdn.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
</head>
<body>
  <div class="container" x-data="statusApp()">
    <header>
      <h1>{{ site_title }}</h1>
      <p class="last-checked" x-show="summary.last_checked">
        Last checked: <span x-text="formatTimestamp(summary.last_checked) + (localTimeLabel(summary.last_checked) ? ' (' + localTimeLabel(summary.last_checked) + ')' : '')"></span>
      </p>
    </header>

    <main>
      {% if site_description %}
      <div class="info-section" x-data="{ open: false }">
        <button class="info-section-header" @click="open = !open" :aria-expanded="open">
          <span>About This Project</span>
          <svg class="chevron" :class="open ? 'chevron-up' : ''" width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
            <path d="M4.427 7.427l3.396 3.396a.25.25 0 00.354 0l3.396-3.396A.25.25 0 0011.396 7H4.604a.25.25 0 00-.177.427z"/>
          </svg>
        </button>
        <div x-show="open" x-collapse>
          <div class="info-section-body">
            <ul>
              {% for item in site_description %}
              <li>{{ item }}</li>
              {% endfor %}
            </ul>
            {% if notification.github_repo and notification.issue_number %}
            <p>Subscribe to status updates: <a href="https://github.com/{{ notification.github_repo }}/issues/{{ notification.issue_number }}" target="_blank" rel="noopener">GitHub Issue #{{ notification.issue_number }}</a></p>
            {% endif %}
          </div>
        </div>
      </div>
      {% endif %}

      {% if site_disclaimer %}
      <div class="info-section" x-data="{ open: false }">
        <button class="info-section-header" @click="open = !open" :aria-expanded="open">
          <span>Disclaimer</span>
          <svg class="chevron" :class="open ? 'chevron-up' : ''" width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
            <path d="M4.427 7.427l3.396 3.396a.25.25 0 00.354 0l3.396-3.396A.25.25 0 0011.396 7H4.604a.25.25 0 00-.177.427z"/>
          </svg>
        </button>
        <div x-show="open" x-collapse>
          <div class="info-section-body">
            <ul>
              {% for item in site_disclaimer %}
              <li>{{ item }}</li>
              {% endfor %}
            </ul>
          </div>
        </div>
      </div>
      {% endif %}

      <!-- Compact current status for all checks -->
      <div class="current-status-section">
        <p class="section-label">Current Status</p>
        <div class="overall-status" :class="'status-banner-' + summary.current_overall_status">
          <span x-text="summary.current_overall"></span>
        </div>
        <div class="current-status-grid">
          <template x-for="check in summary.checks" :key="check.id">
            <a :href="'detail/' + check.id + '.html'" class="current-status-item">
              <span class="current-status-item-name" x-text="check.name"></span>
              <span class="check-status-badge" :class="'badge-' + check.current_status" x-text="check.current_status"></span>
            </a>
          </template>
        </div>
      </div>

      <!-- 90-day history -->
      <h2 class="section-heading">90-Day History</h2>

      <!-- Overall -->
      <div class="check-row">
        <div class="check-header">
          <span class="check-name">Overall</span>
        </div>
        <div class="grid-90">
          <template x-for="day in summary.overall_days" :key="day.date">
            <div class="grid-cell"
                 :class="'cell-' + day.status"
                 :title="day.date + ': ' + day.status"
                 @mouseenter="showTooltip($event, day)"
                 @mouseleave="hideTooltip()">
            </div>
          </template>
          <div class="grid-cell cell-latest"
               :class="'cell-' + summary.current_overall_status"
               @mouseenter="showLatestCellTooltip($event, summary.current_overall_status, '', summary.last_checked, -1)"
               @mouseleave="hideTooltip()">
          </div>
        </div>
      </div>

      <div class="legend">
        <span class="legend-item"><span class="legend-color cell-up"></span> Up</span>
        <span class="legend-item"><span class="legend-color cell-degraded"></span> Degraded</span>
        <span class="legend-item"><span class="legend-color cell-down"></span> Down</span>
        <span class="legend-item"><span class="legend-color cell-nodata"></span> No Data</span>
      </div>

      <!-- Per-check rows -->
      <template x-for="check in summary.checks" :key="check.id">
        <a :href="'detail/' + check.id + '.html'" class="check-row check-row-link">
          <div class="check-header">
            <span class="check-name" x-text="check.name"></span>
            <span class="check-status-badge" :class="'badge-' + check.current_status" x-text="check.current_status"></span>
            <button x-show="check.description || check.note"
                    class="info-toggle"
                    @click.prevent.stop="toggleInfo(check.id)"
                    :aria-expanded="expandedChecks[check.id] || false"
                    aria-label="Toggle details">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                <path d="M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z"/>
              </svg>
            </button>
          </div>
          <div x-show="expandedChecks[check.id]" x-collapse>
            <p class="check-description" x-text="check.description"></p>
            <p x-show="check.note" class="check-note" x-text="check.note"></p>
          </div>
          <div class="grid-90">
            <template x-for="day in check.days" :key="day.date">
              <div class="grid-cell"
                   :class="'cell-' + day.status"
                   :title="day.date"
                   @mouseenter.stop="showCheckTooltip($event, day, check.name)"
                   @mouseleave.stop="hideTooltip()">
              </div>
            </template>
            <div class="grid-cell cell-latest"
                 :class="'cell-' + check.current_status"
                 @mouseenter.stop="showLatestCellTooltip($event, check.current_status, check.name, check.latest_timestamp, check.latest_response_ms)"
                 @mouseleave.stop="hideTooltip()">
            </div>
          </div>
        </a>
      </template>
    </main>

    <!-- Tooltip -->
    <div class="tooltip" x-show="tooltip.visible" x-transition
         :style="'left:' + tooltip.x + 'px; top:' + tooltip.y + 'px'">
      <div class="tooltip-date" x-text="tooltip.date"></div>
      <div x-show="tooltip.name" class="tooltip-name" x-text="tooltip.name"></div>
      <div class="tooltip-status" :class="'text-' + tooltip.status" x-text="tooltip.status"></div>
      <div x-show="tooltip.uptime !== null" class="tooltip-detail">
        Uptime: <span x-text="tooltip.uptime"></span>%
      </div>
      <div x-show="tooltip.avgResp >= 0" class="tooltip-detail">
        Avg response: <span x-text="tooltip.avgResp"></span> ms
      </div>
    </div>

    <footer>
      <p>Unofficial · Not affiliated with Dify or LangGenius</p>
      <p>Built by <a href="https://github.com/kurokobo">@kurokobo</a> with AI assistance · <a href="https://github.com/kurokobo/dify-status">Source on GitHub</a></p>
      <div class="footer-support">
        <a href="https://github.com/sponsors/kurokobo" class="sponsor-btn" target="_blank" rel="noopener">
          <svg height="20" viewBox="0 0 16 16" fill="currentColor" style="vertical-align:middle;margin-right:6px;"><path d="M4.25 2.5c-1.336 0-2.75 1.164-2.75 3 0 2.15 1.58 4.144 3.365 5.682A20.565 20.565 0 008 13.393a20.561 20.561 0 003.135-2.211C12.92 9.644 14.5 7.65 14.5 5.5c0-1.836-1.414-3-2.75-3-1.373 0-2.609.986-3.029 2.456a.75.75 0 01-1.442 0C6.859 3.486 5.623 2.5 4.25 2.5z"/></svg>
          Sponsor on GitHub
        </a>
        <a href="https://www.buymeacoffee.com/kurokobo" class="bmc-btn" target="_blank" rel="noopener">
          <img src="https://cdn.buymeacoffee.com/buttons/v2/default-yellow.png" alt="Buy Me A Coffee" style="height:60px;width:234px;border-radius:12px;">
        </a>
      </div>
    </footer>
  </div>

  <script>
    const SUMMARY_DATA = {{ summary_json | safe }};
  </script>
  <script src="static/app.js"></script>
</body>
</html>
