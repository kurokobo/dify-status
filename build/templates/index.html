<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ site_title }}</title>
  <link rel="icon" type="image/svg+xml" href="static/favicon.svg">
  <script>
    (function(){var t=localStorage.getItem('theme');if(t==='dark'||(t!=='light'&&matchMedia('(prefers-color-scheme:dark)').matches))document.documentElement.setAttribute('data-theme','dark');else document.documentElement.setAttribute('data-theme','light');})();
  </script>
  <link rel="stylesheet" href="static/style.css">
  <script defer src="https://cdn.jsdelivr.net/npm/@alpinejs/collapse@3.x.x/dist/cdn.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
</head>
<body>
  <div class="container" x-data="statusApp()">
    <header>
      <h1>{{ site_title }}</h1>
      <p class="last-checked" x-show="summary.last_checked">
        Last checked: <span x-text="formatTimestamp(summary.last_checked)"></span>
      </p>
    </header>

    <main>
      {% if site_description %}
      <div class="info-section" x-data="{ open: false }">
        <button class="info-section-header" @click="open = !open" :aria-expanded="open">
          <span>About This Project</span>
          <svg class="chevron" :class="open ? 'chevron-up' : ''" width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
            <path d="M4.427 7.427l3.396 3.396a.25.25 0 00.354 0l3.396-3.396A.25.25 0 0011.396 7H4.604a.25.25 0 00-.177.427z"/>
          </svg>
        </button>
        <div x-show="open" x-collapse>
          <div class="info-section-body">
            <ul>
              {% for item in site_description %}
              <li>{{ item }}</li>
              {% endfor %}
            </ul>
            {% if notification.github_repo and notification.issue_number %}
            <p>Subscribe to status updates: <a href="https://github.com/{{ notification.github_repo }}/issues/{{ notification.issue_number }}" target="_blank" rel="noopener">GitHub Issue #{{ notification.issue_number }}</a></p>
            {% endif %}
          </div>
        </div>
      </div>
      {% endif %}

      {% if site_disclaimer %}
      <div class="info-section" x-data="{ open: false }">
        <button class="info-section-header" @click="open = !open" :aria-expanded="open">
          <span>Disclaimer</span>
          <svg class="chevron" :class="open ? 'chevron-up' : ''" width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
            <path d="M4.427 7.427l3.396 3.396a.25.25 0 00.354 0l3.396-3.396A.25.25 0 0011.396 7H4.604a.25.25 0 00-.177.427z"/>
          </svg>
        </button>
        <div x-show="open" x-collapse>
          <div class="info-section-body">
            <ul>
              {% for item in site_disclaimer %}
              <li>{{ item }}</li>
              {% endfor %}
            </ul>
          </div>
        </div>
      </div>
      {% endif %}

      <div x-show="_loading" class="loading">Loading status data...</div>

      <div x-show="!_loading">
      <!-- Compact current status for all checks -->
      <div class="current-status-section">
        <p class="section-label">Current Status</p>
        <div class="overall-status" :class="'status-banner-' + summary.current_overall_status">
          <span x-text="summary.current_overall"></span>
        </div>
        <div class="current-status-grid">
          <template x-for="check in summary.checks" :key="check.id">
            <a :href="'detail/' + check.id + '.html'" class="current-status-item">
              <span class="current-status-item-name" x-text="check.name"></span>
              <span class="check-status-badge" :class="'badge-' + check.current_status" x-text="check.current_status"></span>
            </a>
          </template>
        </div>
      </div>

      <!-- Heading + view mode toggle -->
      <div class="section-heading-row">
        <h2 class="section-heading" x-text="viewModeHeading()"></h2>
        <div class="tz-switcher">
          <button :class="{ 'tz-active': viewMode === '90day' }" @click="switchView('90day')">90D</button>
          <button :class="{ 'tz-active': viewMode === '14d' }" @click="switchView('14d')">14D</button>
          <button :class="{ 'tz-active': viewMode === '7d' }" @click="switchView('7d')">7D</button>
          <button :class="{ 'tz-active': viewMode === '3d' }" @click="switchView('3d')">3D</button>
          <button :class="{ 'tz-active': viewMode === '24h' }" @click="switchView('24h')">24H</button>
        </div>
      </div>
      <div class="tz-switcher-row" x-show="(viewMode === '24h' && !loadingHourly && overallHourly.length > 0) || ((viewMode === '3d' || viewMode === '7d' || viewMode === '14d') && !loadingMultiDay && multiDayOverall.length > 0)">
        <div class="tz-switcher">
          <button :class="{ 'tz-active': !show24hLocalTime }" @click="show24hLocalTime = false">UTC</button>
          <button :class="{ 'tz-active': show24hLocalTime }" @click="show24hLocalTime = true" x-text="tzLabel"></button>
        </div>
      </div>

      <!-- 90-day Overall -->
      <div x-show="viewMode === '90day'">
        <div class="check-row">
          <div class="check-header">
            <span class="check-name">Overall</span>
          </div>
          <div class="grid-90">
            <template x-for="day in summary.overall_days" :key="day.date">
              <div class="grid-cell"
                   :class="'cell-' + day.status"
                   :title="day.date + ': ' + day.status"
                   @mouseenter="showTooltip($event, day)"
                   @mouseleave="hideTooltip()">
              </div>
            </template>
            <div class="grid-cell cell-latest"
                 :class="'cell-' + summary.current_overall_status"
                 @mouseenter="showLatestCellTooltip($event, summary.current_overall_status, '', summary.last_checked, -1)"
                 @mouseleave="hideTooltip()">
            </div>
          </div>
          <div class="grid-90-labels">
            <template x-for="lbl in ninetyDayLabels(summary.overall_days)" :key="lbl.label">
              <span class="grid-90-label-item" :style="'align-items:' + (lbl.isFirst ? 'flex-start' : lbl.isLast ? 'flex-end' : 'center')" x-text="lbl.label"></span>
            </template>
          </div>
        </div>
      </div>

      <!-- 24-hour Overall -->
      <div x-show="viewMode === '24h'">
        <div x-show="loadingHourly" class="loading">Loading hourly data...</div>
        <div x-show="!loadingHourly && overallHourly.length > 0">
          <div class="check-row">
            <div class="check-header">
              <span class="check-name">Overall</span>
            </div>
            <div class="grid-24">
              <template x-for="(h, idx) in overallHourly" :key="idx">
                <div class="grid-cell"
                     :class="'cell-' + h.status"
                     @mouseenter="show24hTooltip($event, h, '')"
                     @mouseleave="hideTooltip()">
                </div>
              </template>
              <div class="grid-cell cell-latest"
                   :class="'cell-' + summary.current_overall_status"
                   @mouseenter="show24hLatestTooltip($event, summary.current_overall_status, '', summary.last_checked, -1)"
                   @mouseleave="hideTooltip()">
              </div>
            </div>
            <div class="hour-labels">
              <template x-for="item in hourLabels24h()" :key="item.key">
                <span class="hour-label-item">
                  <span x-text="item.label"></span>
                  <span x-show="item.shift !== 0" x-text="item.shift > 0 ? '+1d' : '-1d'" class="hour-label-shift"></span>
                </span>
              </template>
            </div>
          </div>
        </div>
      </div>

      <!-- Multi-day (3D/7D/14D) Overall -->
      <div x-show="viewMode === '3d' || viewMode === '7d' || viewMode === '14d'">
        <div x-show="loadingMultiDay" class="loading">Loading data...</div>
        <div x-show="!loadingMultiDay && multiDayOverall.length > 0">
          <div class="check-row">
            <div class="check-header">
              <span class="check-name">Overall</span>
            </div>
            <div class="multiday-grid">
              <template x-for="(day, dayIdx) in multiDaySlice(multiDayOverall)" :key="day.date">
                <div class="multiday-row">
                  <span class="multiday-date">
                    <span x-text="formatShortDate(day.date)"></span>
                    <span class="multiday-dow" x-text="dayOfWeek(day.date)"></span>
                  </span>
                  <div class="grid-24">
                    <template x-for="(h, idx) in day.hours" :key="idx">
                      <div class="grid-cell"
                           :class="'cell-' + h.status"
                           @mouseenter="showMultiDayTooltip($event, h, day.date, '')"
                           @mouseleave="hideTooltip()">
                      </div>
                    </template>
                    <div class="grid-cell cell-latest"
                         :class="dayIdx === _multiDayLastIdx() ? 'cell-' + summary.current_overall_status : 'cell-' + day.dayStatus"
                         @mouseenter="dayIdx === _multiDayLastIdx() ? showLatestCellTooltip($event, summary.current_overall_status, '', summary.last_checked, -1) : showDaySummaryTooltip($event, day, '')"
                         @mouseleave="hideTooltip()">
                    </div>
                  </div>
                </div>
              </template>
              <div class="hour-labels multiday-hour-labels">
                <template x-for="item in multiDayHourLabels()" :key="item.key">
                  <span class="hour-label-item">
                    <span x-text="item.label"></span>
                    <span x-show="item.shift !== 0" x-text="item.shift > 0 ? '+1d' : '-1d'" class="hour-label-shift"></span>
                  </span>
                </template>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Legend (shared, right after Overall) -->
      <div x-data="{ open: false }">
        <div class="legend">
          <span class="legend-item"><span class="legend-color cell-up"></span> Up</span>
          <span class="legend-item"><span class="legend-color cell-degraded"></span> Degraded</span>
          <span class="legend-item"><span class="legend-color cell-down"></span> Down</span>
          <span class="legend-item"><span class="legend-color cell-nodata"></span> No Data</span>
          <button class="info-toggle legend-info-toggle" @click="open = !open" :aria-expanded="open" aria-label="Show status criteria">
            <svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor">
              <path d="M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z"/>
            </svg>
          </button>
        </div>
        <div x-show="open" x-collapse>
          <div class="legend-criteria">
            <p><strong>Overall:</strong> Up = all components Up; Degraded = at least one component was Degraded or Down; Down = at least one component was Down</p>
            <p><strong>Per component:</strong> Up = all checks passed; Degraded = &lt;50% of checks were down; Down = &ge;50% of checks were down</p>
          </div>
        </div>
      </div>

      <!-- 90-day per-check rows -->
      <div x-show="viewMode === '90day'">
        <template x-for="check in summary.checks" :key="check.id">
          <a :href="'detail/' + check.id + '.html'" class="check-row check-row-link">
            <div class="check-header">
              <span class="check-name" x-text="check.name"></span>
              <span class="check-status-badge" :class="'badge-' + check.current_status" x-text="check.current_status"></span>
              <button x-show="check.description || check.note"
                      class="info-toggle"
                      @click.prevent.stop="toggleInfo(check.id)"
                      :aria-expanded="expandedChecks[check.id] || false"
                      aria-label="Toggle details">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                  <path d="M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z"/>
                </svg>
              </button>
            </div>
            <div x-show="expandedChecks[check.id]" x-collapse>
              <p class="check-description" x-text="check.description"></p>
              <p x-show="check.note" class="check-note" x-text="check.note"></p>
            </div>
            <div class="grid-90">
              <template x-for="day in check.days" :key="day.date">
                <div class="grid-cell"
                     :class="'cell-' + day.status"
                     :title="day.date"
                     @click.prevent.stop="window.location.href = 'detail/' + check.id + '.html#' + day.date"
                     @mouseenter.stop="showCheckTooltip($event, day, check.name)"
                     @mouseleave.stop="hideTooltip()">
                </div>
              </template>
              <div class="grid-cell cell-latest"
                   :class="'cell-' + check.current_status"
                   @mouseenter.stop="showLatestCellTooltip($event, check.current_status, check.name, check.latest_timestamp, check.latest_response_ms)"
                   @mouseleave.stop="hideTooltip()">
              </div>
            </div>
            <div class="grid-90-labels">
              <template x-for="lbl in ninetyDayLabels(check.days)" :key="lbl.label">
                <span class="grid-90-label-item" :style="'align-items:' + (lbl.isFirst ? 'flex-start' : lbl.isLast ? 'flex-end' : 'center')" x-text="lbl.label"></span>
              </template>
            </div>
          </a>
        </template>
      </div>

      <!-- 24-hour per-check rows -->
      <div x-show="viewMode === '24h' && !loadingHourly && hourlyChecks.length > 0">
        <template x-for="hcheck in hourlyChecks" :key="hcheck.id">
          <a :href="'detail/' + hcheck.id + '.html'" class="check-row check-row-link">
            <div class="check-header">
              <span class="check-name" x-text="hcheck.name"></span>
              <span class="check-status-badge" :class="'badge-' + hcheck.current_status" x-text="hcheck.current_status"></span>
            </div>
            <div class="grid-24">
              <template x-for="(h, idx) in hcheck.hours" :key="idx">
                <div class="grid-cell"
                     :class="'cell-' + h.status"
                     @mouseenter.stop="show24hTooltip($event, h, hcheck.name)"
                     @mouseleave.stop="hideTooltip()">
                </div>
              </template>
              <div class="grid-cell cell-latest"
                   :class="'cell-' + hcheck.current_status"
                   @mouseenter.stop="show24hLatestTooltip($event, hcheck.current_status, hcheck.name, hcheck.latest_timestamp, hcheck.latest_response_ms)"
                   @mouseleave.stop="hideTooltip()">
              </div>
            </div>
            <div class="hour-labels">
              <template x-for="item in hourLabels24h()" :key="item.key">
                <span class="hour-label-item">
                  <span x-text="item.label"></span>
                  <span x-show="item.shift !== 0" x-text="item.shift > 0 ? '+1d' : '-1d'" class="hour-label-shift"></span>
                </span>
              </template>
            </div>
          </a>
        </template>
      </div>

      <!-- Multi-day (3D/7D/14D) per-check rows -->
      <div x-show="(viewMode === '3d' || viewMode === '7d' || viewMode === '14d') && !loadingMultiDay && multiDayChecks.length > 0">
        <template x-for="mcheck in multiDayChecks" :key="mcheck.id">
          <a :href="'detail/' + mcheck.id + '.html'" class="check-row check-row-link">
            <div class="check-header">
              <span class="check-name" x-text="mcheck.name"></span>
              <span class="check-status-badge" :class="'badge-' + mcheck.current_status" x-text="mcheck.current_status"></span>
            </div>
            <div class="multiday-grid">
              <template x-for="(day, dayIdx) in multiDaySlice(mcheck.days)" :key="day.date">
                <div class="multiday-row">
                  <a class="multiday-date" :href="'detail/' + mcheck.id + '.html#' + day.date" @click.stop>
                    <span x-text="formatShortDate(day.date)"></span>
                    <span class="multiday-dow" x-text="dayOfWeek(day.date)"></span>
                  </a>
                  <div class="grid-24">
                    <template x-for="(h, idx) in day.hours" :key="idx">
                      <div class="grid-cell"
                           :class="'cell-' + h.status"
                           @click.prevent.stop="window.location.href = 'detail/' + mcheck.id + '.html#' + day.date"
                           @mouseenter.stop="showMultiDayTooltip($event, h, day.date, mcheck.name)"
                           @mouseleave.stop="hideTooltip()">
                      </div>
                    </template>
                    <div class="grid-cell cell-latest"
                         :class="dayIdx === _multiDayLastIdx() ? 'cell-' + mcheck.current_status : 'cell-' + day.dayStatus"
                         @click.prevent.stop="window.location.href = 'detail/' + mcheck.id + '.html#' + day.date"
                         @mouseenter.stop="dayIdx === _multiDayLastIdx() ? show24hLatestTooltip($event, mcheck.current_status, mcheck.name, mcheck.latest_timestamp, mcheck.latest_response_ms) : showDaySummaryTooltip($event, day, mcheck.name)"
                         @mouseleave.stop="hideTooltip()">
                    </div>
                  </div>
                </div>
              </template>
              <div class="hour-labels multiday-hour-labels">
                <template x-for="item in multiDayHourLabels()" :key="item.key">
                  <span class="hour-label-item">
                    <span x-text="item.label"></span>
                    <span x-show="item.shift !== 0" x-text="item.shift > 0 ? '+1d' : '-1d'" class="hour-label-shift"></span>
                  </span>
                </template>
              </div>
            </div>
          </a>
        </template>
      </div>
      </div>
    </main>

    {% include '_tooltip.html' %}

    {% include '_footer.html' %}
  </div>

  <script>
    window._summaryPromise = fetch('data/summary.json').then(r => r.json());
  </script>
  <script src="static/app.js"></script>
</body>
</html>
